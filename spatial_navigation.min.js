(function(){function C(a){a=a||{};for(var b=1;b<arguments.length;b++)if(arguments[b])for(var c in arguments[b])arguments[b].hasOwnProperty(c)&&void 0!==arguments[b][c]&&(a[c]=arguments[b][c]);return a}function x(a){return"string"===typeof a?[].slice.call(document.querySelectorAll(a)):"object"===typeof a&&a.length?[].slice.call(a):"object"===typeof a&&1===a.nodeType?[a]:[]}function D(a,b){return"string"===typeof b?W.call(a,b):"object"===typeof b&&b.length?0<=b.indexOf(a):"object"===typeof b&&1===b.nodeType?
a===b:!1}function z(a){var b=[],c=function(a){a&&0>b.indexOf(a)&&e[a]&&!e[a].disabled&&b.push(a)};a?c(a):(c(A),c(r),Object.keys(e).map(c));for(a=0;a<b.length;a++){c=b[a];var d=X(c)||L(c)||E(c).filter(function(a){return"-2"!=a.getAttribute("tabindex")})[0];if(d)return y(d,c)}return!1}function X(a){var b=e[a].defaultElement;if(!b)return null;"string"===typeof b&&(b=x(b)[0]);return v(b,a,!0)?b:null}function L(a){var b=e[a].lastFocusedElement;return v(b,a,!0)?b:null}function v(a,b,c){if(!a||!b||!e[b]||
e[b].disabled||0>=a.offsetWidth&&0>=a.offsetHeight||a.hasAttribute("disabled")||c&&!D(a,e[b].selector))return!1;if("function"===typeof e[b].navigableFilter){if(!1===e[b].navigableFilter(a,b))return!1}else if("function"===typeof w.navigableFilter&&!1===w.navigableFilter(a,b))return!1;return!0}function E(a){return x(e[a].selector).filter(function(b){return v(b,a)})}function y(a,b,c){if(!a)return!1;var d=p(),g=function(){d&&d.blur();a.focus();B(a,b)};if(l)return!g();l=!0;if(q)return g(),!(l=!1);if(d){g=
{nextElement:a,nextSectionId:b,direction:c,"native":!1};if(!h(d,"willunfocus",g))return l=!1;d.blur();h(d,"unfocused",g,!1)}c={previousElement:d,sectionId:b,direction:c,"native":!1};if(!h(a,"willfocus",c))return l=!1;a.focus();h(a,"focused",c,!1);l=!1;return!B(a,b)}function p(){if(document.activeElement&&document.activeElement!==document.body)return document.activeElement}function h(a,b,c,d){var g=document.createEvent("CustomEvent");if("contextmenu"==b){g.initCustomEvent(b,!0,4>arguments.length?!0:
d,c);var f=a.getBoundingClientRect();Object.defineProperties(g,{layerX:{value:a.clientLeft+25,enumerable:!0},layerY:{value:a.clientTop,enumerable:!0},clientX:{value:f.x,enumerable:!0},clientY:{value:f.y+f.height,enumerable:!0},pageX:{value:f.x,enumerable:!0},pageY:{value:f.y,enumerable:!0}})}else g.initCustomEvent("sn:"+b,!0,4>arguments.length?!0:d,c);return a.dispatchEvent(g)}function B(a,b){b||(b=k(a));b&&(e[b].lastFocusedElement=a,r=b)}function k(a){for(var b in e)if(!e[b].disabled&&D(a,e[b].selector))return b}
function F(a,b){if("@"==a.charAt(0))return z(1==a.length?null:a.substr(1));var c=x(a)[0];if(c){var d=k(c);if(v(c,d))return y(c,d,b)}return!1}function M(a,b,c){var d=b.getAttribute("data-sn-"+a);if("string"===typeof d)return""!==d&&F(d,a)?!0:!!G(b,a);d={};var g=[];for(f in e)g=g.concat(d[f]=E(f));var f=C({},w,e[c]);if("self-only"==f.restrict||"self-first"==f.restrict){var N=d[c];(d=H(b,a,I(N,b),f))||"self-first"!=f.restrict||(d=H(b,a,I(g,N),f))}else d=H(b,a,I(g,b),f);if(d){g=k(d);if(c!=g){if(c=O(c,
a))return!0;if(null===c)return!!G(b,a)}return d.closest("aside")||(b=J(d),window.pageYOffset+b.bottom>window.pageYOffset&&window.pageYOffset+b.top<window.pageYOffset+document.documentElement.clientHeight+100&&window.pageXOffset+b.right>window.pageXOffset&&window.pageXOffset+b.left<window.pageXOffset+document.documentElement.clientWidth)?y(d,g,a):!1}return O(c,a)?!0:!!G(b,a)}function H(a,b,c,d){if(!(a&&b&&c&&c.length))return null;d=[];for(var g=0;g<c.length;g++){var f=J(c[g]);f&&d.push(f)}if(!d.length)return null;
var e=J(a);if(!e)return null;a=function(a){a=a.center.x<e.center.x?e.center.x-a.right:a.left-e.center.x;return 0>a?0:a};c=function(a){a=a.center.y<e.center.y?e.center.y-a.bottom:a.top-e.center.y;return 0>a?0:a};g=function(a){a=a.center.x<e.center.x?e.left-a.right:a.left-e.left;return 0>a?0:a};f=function(a){a=a.center.y<e.center.y?e.top-a.bottom:a.top-e.top;return 0>a?0:a};var h=function(a){return a.top},l=function(a){return-1*a.bottom},k=function(a){return a.left},n=function(a){return-1*a.right};
d=P(d,e);var m=P(d[4],e.center);switch(b){case "left":d=[{group:m[0].concat(m[3]).concat(m[6]),distance:[a,h]},{group:d[3],distance:[a,h]},{group:d[0].concat(d[6]),distance:[c,n,f]}];break;case "right":d=[{group:m[2].concat(m[5]).concat(m[8]),distance:[a,h]},{group:d[5],distance:[a,h]},{group:d[2].concat(d[8]),distance:[c,k,f]}];break;case "up":d=[{group:m[0].concat(m[1]).concat(m[2]),distance:[c,k]},{group:d[1],distance:[c,k]},{group:d[0].concat(d[2]),distance:[a,l,g]}];break;case "down":d=[{group:m[6].concat(m[7]).concat(m[8]),
distance:[c,k]},{group:d[7].concat(d[7].length&&d[8].length&&d[7][0].top>d[8][0].top?d[8]:[]),distance:[c,k]},{group:d[6].concat(d[8]),distance:[a,h,g]}];break;default:return null}a=Q(d.slice(0,-1));return!a&&(!(a=Q(d.slice(-1)))||"up"==b&&(e.top<a[0].top||e.left<a[0].left)||"right"==b&&(e.left>a[0].left||e.bottom>a[0].bottom||a[0].right>document.documentElement.clientWidth)||"down"==b&&(e.bottom>a[0].bottom||e.right<a[0].right||0>a[0].left)||"left"==b&&(e.left<a[0].left||e.top<a[0].top||0>a[0].left))?
null:a[0].element}function I(a,b){Array.isArray(b)||(b=[b]);for(var c=0,d;c<b.length;c++)0<=(d=a.indexOf(b[c]))&&a.splice(d,1);return a}function J(a){var b=a.getBoundingClientRect();b={left:b.left,top:b.top,right:b.right,bottom:b.bottom,width:b.width,height:b.height};b.element=a;b.center={x:b.left+Math.floor(b.width/2),y:b.top+Math.floor(b.height/2)};b.center.left=b.center.right=b.center.x;b.center.top=b.center.bottom=b.center.y;return b}function P(a,b){for(var c=[[],[],[],[],[],[],[],[],[]],d=0;d<
a.length;d++){var e=a[d],f=e.center;f=3*(f.y<b.top?0:f.y<=b.bottom?1:2)+(f.x<b.left?0:f.x<=b.right?1:2);c[f].push(e);-1!==[0,2,6,8].indexOf(f)&&(e.left<=b.right-.5*b.width&&(2===f?c[1].push(e):8===f&&c[7].push(e)),e.right>=b.left+.5*b.width&&(0===f?c[1].push(e):6===f&&c[7].push(e)),e.top<=b.bottom-.5*b.height&&(6===f?c[3].push(e):8===f&&c[5].push(e)),e.bottom>=b.top+.5*b.height&&(0===f?c[3].push(e):2===f&&c[5].push(e)))}return c}function Q(a){for(var b=null,c=0;c<a.length;c++)a[c].group.length&&(b=
a[c]);if(!b)return null;b.group.sort(function(a,c){for(var d=0;d<b.distance.length;d++){var e=b.distance[d];if(e=e(a)-e(c))return e}return 0});return b.group}function O(a,b){if(e[a].leaveFor&&void 0!==e[a].leaveFor[b]){var c=e[a].leaveFor[b];if("string"===typeof c)return""===c?null:F(c,b);var d=k(c);if(v(c,d))return y(c,d,b)}return!1}function G(a,b){h(a,"navigatefailed",{direction:b},!1)}function R(a){if(!(!t||q||a.altKey||a.ctrlKey||a.metaKey||a.shiftKey)){var b,c=function(){a.preventDefault();a.stopPropagation();
return!1},d={37:"left",38:"up",39:"right",40:"down"}[a.keyCode];if(d){if(!(b=p())&&(r&&(b=L(r)),!b))return z(),c();var e=k(b);if(e){if(!(b.scrollHeight==b.offsetHeight||-1!=["hidden","visible"].indexOf(getComputedStyle(b).overflow)||("up"!=d||0>=b.scrollTop)&&("down"!=d||b.scrollTop>=b.scrollHeight-b.offsetHeight)))return!1;if(h(b,"willmove",{direction:d,sectionId:e,cause:"keydown"})&&(M(d,b,e)||b.closest("aside")))return c()}}else if(13==a.keyCode&&(b=p())&&k(b))return null==u?u=a.timeStamp:u&&1500<
a.timeStamp-u&&(h(b,"contextmenu"),u=0),h(b,"enter-down"),c()}}function S(a){if(!(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey||q)&&t&&13==a.keyCode){var b=p();b&&k(b)&&(0!=u&&b.click(),h(b,"enter-up"),a.preventDefault(),a.stopPropagation());u=null}}function T(a){if(a.target!==window&&a.target!==document&&t&&!l){var b=k(a.target);if(b){if(q)return B(a.target,b);var c={sectionId:b,"native":!0};h(a.target,"willfocus",c)?(h(a.target,"focused",c,!1),B(a.target,b)):(l=!0,a.target.blur(),l=!1)}}}function U(a){if(a.target!==
window&&a.target!==document&&!q&&t&&!l&&k(a.target)){var b={"native":!0};h(a.target,"willunfocus",b)?h(a.target,"unfocused",b,!1):(l=!0,setTimeout(function(){a.target.focus();l=!1}))}}var w={selector:"",disabled:!1,defaultElement:"",leaveFor:null,restrict:"self-first",tabIndexIgnoreList:"input, select, textarea, iframe, [contentEditable=true]",navigableFilter:null},V=0,K=!1,q=!1,u=null,e={},t=0,A="",r="",l=!1,W=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||
Element.prototype.webkitMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||function(a){return 0<=[].slice.call((this.parentNode||this.document).querySelectorAll(a)).indexOf(this)},n={init:function(a){var b=[];if(!K&&(window.addEventListener("keydown",R),window.addEventListener("keyup",S),window.addEventListener("focus",T,!0),window.addEventListener("blur",U,!0),K=!0,a)){for(var c in a)b.push(n.add(c,a[c]));n.makeFocusable();n.focus()}return b},uninit:function(){window.removeEventListener("blur",
U,!0);window.removeEventListener("focus",T,!0);window.removeEventListener("keyup",S);window.removeEventListener("keydown",R);n.clear();V=0;K=!1},clear:function(){e={};t=0;r=A="";l=!1},add:function(a,b){var c={};if("object"===typeof a)c=a;else if("string"===typeof a&&"object"===typeof b){var d=a;c=b}if(!d)if("string"===typeof c.id)d=c.id;else for(;e[d="section-"+String(++V)];);if(e[d])throw Error('Section "'+d+'" has already existed!');e[d]={};t++;n.set(d,c);return d},set:function(a,b){if("object"===
typeof a)var c=a;else if("string"===typeof a&&"object"===typeof b){var d=a;c=b;if(!e[d])throw Error('Section "'+d+"\" doesn't exist!");}else return;for(var g in c)void 0!==w[g]&&(d?e[d][g]=c[g]:void 0!==c[g]&&(w[g]=c[g]));d&&(e[d]=C({},e[d]))},remove:function(a){if(!a||"string"!==typeof a)throw Error('Please assign the "sectionId"!');return e[a]?(e[a]=void 0,e=C({},e),t--,r===a&&(r=""),!0):!1},disable:function(a){return e[a]?e[a].disabled=!0:!1},enable:function(a){return e[a]?!(e[a].disabled=!1):
!1},pause:function(){q=!0},resume:function(){q=!1},move:function(a,b){a=a.toLowerCase();var c=b?x(b)[0]:p();if(!c)return!1;var d=k(c);return d&&h(c,"willmove",{direction:a,sectionId:d,cause:"api"})?M(a,c,d):!1},makeFocusable:function(a){var b=function(a){var b=void 0!==a.tabIndexIgnoreList?a.tabIndexIgnoreList:w.tabIndexIgnoreList;x(a.selector).forEach(function(a){D(a,b)||a.getAttribute("tabindex")||a.setAttribute("tabindex","-1")})};if(a)if(e[a])b(e[a]);else throw Error('Section "'+a+"\" doesn't exist!");
else for(var c in e)b(e[c])},focus:function(a,b){var c=!1;void 0===b&&"boolean"===typeof a&&(b=a,a=void 0);var d=!q&&b;d&&n.pause();if(a)if("string"===typeof a)c=e[a]?z(a):F(a);else{var g=k(a);v(a,g)&&(c=y(a,g))}else c=z();d&&n.resume();return c},setDefaultSection:function(a){if(a)if(e[a])A=a;else throw Error('Section "'+a+"\" doesn't exist!");else A=""},getElement:function(){return p()},getSection:function(a){return k(a||p())},getElements:function(a){return E(a||k(p()))},getSections:function(){return e}};
"SpatialNavigation"in window||(window.SpatialNavigation=n);"object"===typeof module&&(module.exports=n)})();