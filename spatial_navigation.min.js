(function(){function C(a){a=a||{};for(var b=1;b<arguments.length;b++)if(arguments[b])for(var c in arguments[b])arguments[b].hasOwnProperty(c)&&void 0!==arguments[b][c]&&(a[c]=arguments[b][c]);return a}function x(a){return"string"===typeof a?[].slice.call(document.querySelectorAll(a)):"object"===typeof a&&a.length?[].slice.call(a):"object"===typeof a&&1===a.nodeType?[a]:[]}function D(a,b){return"string"===typeof b?V.call(a,b):"object"===typeof b&&b.length?0<=b.indexOf(a):"object"===typeof b&&1===b.nodeType?
a===b:!1}function z(a){var b=[],c=function(a){a&&0>b.indexOf(a)&&e[a]&&!e[a].disabled&&b.push(a)};a?c(a):(c(A),c(t),Object.keys(e).map(c));for(a=0;a<b.length;a++){c=b[a];var d=W(c)||L(c)||E(c).filter(function(a){return"-2"!=a.getAttribute("tabindex")})[0];if(d)return y(d,c)}return!1}function W(a){var b=e[a].defaultElement;if(!b)return null;"string"===typeof b&&(b=x(b)[0]);return v(b,a,!0)?b:null}function L(a){var b=e[a].lastFocusedElement;return v(b,a,!0)?b:null}function v(a,b,c){if(!a||!b||!e[b]||
e[b].disabled||0>=a.offsetWidth&&0>=a.offsetHeight||a.hasAttribute("disabled")||c&&!D(a,e[b].selector))return!1;if("function"===typeof e[b].navigableFilter){if(!1===e[b].navigableFilter(a,b))return!1}else if("function"===typeof w.navigableFilter&&!1===w.navigableFilter(a,b))return!1;return!0}function E(a){return x(e[a].selector).filter(function(b){return v(b,a)})}function y(a,b,c){if(!a)return!1;var d=q(),f=function(){d&&d.blur();a.focus();B(a,b)};if(h)return!f();h=!0;if(r)return f(),!(h=!1);if(d){f=
{nextElement:a,nextSectionId:b,direction:c,"native":!1};if(!l(d,"willunfocus",f))return h=!1;d.blur();l(d,"unfocused",f,!1)}c={previousElement:d,sectionId:b,direction:c,"native":!1};if(!l(a,"willfocus",c))return h=!1;a.focus();l(a,"focused",c,!1);h=!1;return!B(a,b)}function q(){if(document.activeElement&&document.activeElement!==document.body)return document.activeElement}function l(a,b,c,d){var f=document.createEvent("CustomEvent");f.initCustomEvent("sn:"+b,!0,4>arguments.length?!0:d,c);return a.dispatchEvent(f)}
function B(a,b){b||(b=k(a));b&&(e[b].lastFocusedElement=a,t=b)}function k(a){for(var b in e)if(!e[b].disabled&&D(a,e[b].selector))return b}function F(a,b){if("@"==a.charAt(0))return z(1==a.length?null:a.substr(1));var c=x(a)[0];if(c){var d=k(c);if(v(c,d))return y(c,d,b)}return!1}function M(a,b,c){var d=b.getAttribute("data-sn-"+a);if("string"===typeof d)return""!==d&&F(d,a)?!0:!!G(b,a);d={};var f=[];for(p in e)f=f.concat(d[p]=E(p));var p=C({},w,e[c]);if("self-only"==p.restrict||"self-first"==p.restrict){var g=
d[c];(d=H(b,a,I(g,b),p))||"self-first"!=p.restrict||(d=H(b,a,I(f,g),p))}else d=H(b,a,I(f,b),p);if(d){f=k(d);if(c!=f){if(c=N(c,a))return!0;if(null===c)return!!G(b,a)}return d.closest("aside")||(b=J(d),window.pageYOffset+b.bottom>window.pageYOffset&&window.pageYOffset+b.top<window.pageYOffset+document.documentElement.clientHeight+100&&window.pageXOffset+b.right>window.pageXOffset&&window.pageXOffset+b.left<window.pageXOffset+document.documentElement.clientWidth)?y(d,f,a):!1}return N(c,a)?!0:!!G(b,a)}
function H(a,b,c,d){if(!(a&&b&&c&&c.length))return null;d=[];for(var f=0;f<c.length;f++){var e=J(c[f]);e&&d.push(e)}if(!d.length)return null;var g=J(a);if(!g)return null;a=function(a){a=a.center.x<g.center.x?g.center.x-a.right:a.left-g.center.x;return 0>a?0:a};c=function(a){a=a.center.y<g.center.y?g.center.y-a.bottom:a.top-g.center.y;return 0>a?0:a};f=function(a){a=a.center.x<g.center.x?g.left-a.right:a.left-g.left;return 0>a?0:a};e=function(a){a=a.center.y<g.center.y?g.top-a.bottom:a.top-g.top;return 0>
a?0:a};var h=function(a){return a.top},l=function(a){return-1*a.bottom},k=function(a){return a.left},n=function(a){return-1*a.right};d=O(d,g);var m=O(d[4],g.center);switch(b){case "left":d=[{group:m[0].concat(m[3]).concat(m[6]),distance:[a,h]},{group:d[3],distance:[a,h]},{group:d[0].concat(d[6]),distance:[c,n,e]}];break;case "right":d=[{group:m[2].concat(m[5]).concat(m[8]),distance:[a,h]},{group:d[5],distance:[a,h]},{group:d[2].concat(d[8]),distance:[c,k,e]}];break;case "up":d=[{group:m[0].concat(m[1]).concat(m[2]),
distance:[c,k]},{group:d[1],distance:[c,k]},{group:d[0].concat(d[2]),distance:[a,l,f]}];break;case "down":d=[{group:m[6].concat(m[7]).concat(m[8]),distance:[c,k]},{group:d[7].concat(d[7].length&&d[8].length&&d[7][0].top>d[8][0].top?d[8]:[]),distance:[c,k]},{group:d[6].concat(d[8]),distance:[a,h,f]}];break;default:return null}a=P(d.slice(0,-1));return!a&&(!(a=P(d.slice(-1)))||"up"==b&&(g.top<a[0].top||g.left<a[0].left)||"right"==b&&(g.left>a[0].left||g.bottom>a[0].bottom||a[0].right>document.documentElement.clientWidth)||
"down"==b&&(g.bottom>a[0].bottom||g.right<a[0].right||0>a[0].left)||"left"==b&&(g.left<a[0].left||g.top<a[0].top||0>a[0].left))?null:a[0].element}function I(a,b){Array.isArray(b)||(b=[b]);for(var c=0,d;c<b.length;c++)0<=(d=a.indexOf(b[c]))&&a.splice(d,1);return a}function J(a){var b=a.getBoundingClientRect();b={left:b.left,top:b.top,right:b.right,bottom:b.bottom,width:b.width,height:b.height};b.element=a;b.center={x:b.left+Math.floor(b.width/2),y:b.top+Math.floor(b.height/2)};b.center.left=b.center.right=
b.center.x;b.center.top=b.center.bottom=b.center.y;return b}function O(a,b){for(var c=[[],[],[],[],[],[],[],[],[]],d=0;d<a.length;d++){var f=a[d],e=f.center;e=3*(e.y<b.top?0:e.y<=b.bottom?1:2)+(e.x<b.left?0:e.x<=b.right?1:2);c[e].push(f);-1!==[0,2,6,8].indexOf(e)&&(f.left<=b.right-.5*b.width&&(2===e?c[1].push(f):8===e&&c[7].push(f)),f.right>=b.left+.5*b.width&&(0===e?c[1].push(f):6===e&&c[7].push(f)),f.top<=b.bottom-.5*b.height&&(6===e?c[3].push(f):8===e&&c[5].push(f)),f.bottom>=b.top+.5*b.height&&
(0===e?c[3].push(f):2===e&&c[5].push(f)))}return c}function P(a){for(var b=null,c=0;c<a.length;c++)a[c].group.length&&(b=a[c]);if(!b)return null;b.group.sort(function(a,c){for(var d=0;d<b.distance.length;d++){var e=b.distance[d];if(e=e(a)-e(c))return e}return 0});return b.group}function N(a,b){if(e[a].leaveFor&&void 0!==e[a].leaveFor[b]){var c=e[a].leaveFor[b];if("string"===typeof c)return""===c?null:F(c,b);var d=k(c);if(v(c,d))return y(c,d,b)}return!1}function G(a,b){l(a,"navigatefailed",{direction:b},
!1)}function Q(a){if(!(!u||r||a.altKey||a.ctrlKey||a.metaKey||a.shiftKey)){var b,c=function(){a.preventDefault();a.stopPropagation();return!1},d={37:"left",38:"up",39:"right",40:"down"}[a.keyCode];if(d){if(!(b=q())&&(t&&(b=L(t)),!b))return z(),c();var e=k(b);if(e){if(!(b.scrollHeight==b.offsetHeight||-1!=["hidden","visible"].indexOf(getComputedStyle(b).overflow)||("up"!=d||0>=b.scrollTop)&&("down"!=d||b.scrollTop>=b.scrollHeight-b.offsetHeight)))return!1;if(l(b,"willmove",{direction:d,sectionId:e,
cause:"keydown"})&&(M(d,b,e)||b.closest("aside")))return c()}}else if(13==a.keyCode&&(b=q())&&k(b)&&!l(b,"enter-down"))return c()}}function R(a){if(!(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey||r)&&u&&13==a.keyCode){var b=q();b&&k(b)&&!l(b,"enter-up")&&(a.preventDefault(),a.stopPropagation())}}function S(a){if(a.target!==window&&a.target!==document&&u&&!h){var b=k(a.target);if(b){if(r)return B(a.target,b);var c={sectionId:b,"native":!0};l(a.target,"willfocus",c)?(l(a.target,"focused",c,!1),B(a.target,
b)):(h=!0,a.target.blur(),h=!1)}}}function T(a){if(a.target!==window&&a.target!==document&&!r&&u&&!h&&k(a.target)){var b={"native":!0};l(a.target,"willunfocus",b)?l(a.target,"unfocused",b,!1):(h=!0,setTimeout(function(){a.target.focus();h=!1}))}}var w={selector:"",disabled:!1,defaultElement:"",leaveFor:null,restrict:"self-first",tabIndexIgnoreList:"input, select, textarea, iframe, [contentEditable=true]",navigableFilter:null},U=0,K=!1,r=!1,e={},u=0,A="",t="",h=!1,V=Element.prototype.matches||Element.prototype.matchesSelector||
Element.prototype.mozMatchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||function(a){return 0<=[].slice.call((this.parentNode||this.document).querySelectorAll(a)).indexOf(this)},n={init:function(a){var b=[];K||(window.addEventListener("keydown",Q),window.addEventListener("keyup",R),window.addEventListener("focus",S,!0),window.addEventListener("blur",T,!0),K=!0,a&&(b=a.map(function(a){return n.add(a)}),n.makeFocusable(),
n.focus()));return b},uninit:function(){window.removeEventListener("blur",T,!0);window.removeEventListener("focus",S,!0);window.removeEventListener("keyup",R);window.removeEventListener("keydown",Q);n.clear();U=0;K=!1},clear:function(){e={};u=0;t=A="";h=!1},add:function(a,b){var c={};if("object"===typeof a)c=a;else if("string"===typeof a&&"object"===typeof b){var d=a;c=b}if(!d)if("string"===typeof c.id)d=c.id;else for(;e[d="section-"+String(++U)];);if(e[d])throw Error('Section "'+d+'" has already existed!');
e[d]={};u++;n.set(d,c);return d},set:function(a,b){if("object"===typeof a)var c=a;else if("string"===typeof a&&"object"===typeof b){var d=a;c=b;if(!e[d])throw Error('Section "'+d+"\" doesn't exist!");}else return;for(var f in c)void 0!==w[f]&&(d?e[d][f]=c[f]:void 0!==c[f]&&(w[f]=c[f]));d&&(e[d]=C({},e[d]))},remove:function(a){if(!a||"string"!==typeof a)throw Error('Please assign the "sectionId"!');return e[a]?(e[a]=void 0,e=C({},e),u--,t===a&&(t=""),!0):!1},disable:function(a){return e[a]?e[a].disabled=
!0:!1},enable:function(a){return e[a]?!(e[a].disabled=!1):!1},pause:function(){r=!0},resume:function(){r=!1},move:function(a,b){a=a.toLowerCase();var c=b?x(b)[0]:q();if(!c)return!1;var d=k(c);return d&&l(c,"willmove",{direction:a,sectionId:d,cause:"api"})?M(a,c,d):!1},makeFocusable:function(a){var b=function(a){var b=void 0!==a.tabIndexIgnoreList?a.tabIndexIgnoreList:w.tabIndexIgnoreList;x(a.selector).forEach(function(a){D(a,b)||a.getAttribute("tabindex")||a.setAttribute("tabindex","-1")})};if(a)if(e[a])b(e[a]);
else throw Error('Section "'+a+"\" doesn't exist!");else for(var c in e)b(e[c])},focus:function(a,b){var c=!1;void 0===b&&"boolean"===typeof a&&(b=a,a=void 0);var d=!r&&b;d&&n.pause();if(a)if("string"===typeof a)c=e[a]?z(a):F(a);else{var f=k(a);v(a,f)&&(c=y(a,f))}else c=z();d&&n.resume();return c},setDefaultSection:function(a){if(a)if(e[a])A=a;else throw Error('Section "'+a+"\" doesn't exist!");else A=""},getElement:function(){return q()},getSection:function(a){return k(a||q())},getElements:function(a){return E(a||
k(q()))}};window.SpatialNavigation=n;"object"===typeof module&&(module.exports=n)})();